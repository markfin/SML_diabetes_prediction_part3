
name: Preprocess Diabetes Data

on:
  push:
    branches:
      - main

jobs:
  preprocess-data:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas numpy requests

    - name: Run data preprocessing and save
      run: |
        python -c "import pandas as pd; import numpy as np; import requests; from automate_diabetes_prediction_part3 import preprocess_diabetes_data; url = 'https://raw.githubusercontent.com/plotly/datasets/master/diabetes.csv'; file_name = 'diabetes_prediction.csv'; try:     response = requests.get(url);     response.raise_for_status();     with open(file_name, 'wb') as f:         f.write(response.content);     print(f"Dataset downloaded for workflow as '{file_name}'."); except requests.exceptions.RequestException as e:     print(f"Error downloading dataset for workflow: {e}"); df = pd.read_csv(file_name); df_processed = preprocess_diabetes_data(df.copy()); output_file_name = 'processed_diabetes.csv'; df_processed.to_csv(output_file_name, index=False); print(f"Processed data saved to '{output_file_name}'.")"

    - name: Commit and push processed data
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        git add processed_diabetes.csv
        git commit -m "Update processed_diabetes.csv after data preprocessing" || echo "No changes to commit"
        git push
